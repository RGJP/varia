<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Solfeggio Frequencies Tone Generator for Meditation and Healing">
    <title>Solfeggio Healer | Pure Tone Generator</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(to bottom, #0f2027, #203a43, #2c5364);
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.15);
            --text-color: #e6edf3;
            --text-muted: rgba(230, 237, 243, 0.6);
            --accent-color: #4facfe;
            --accent-glow: 0 0 25px rgba(79, 172, 254, 0.5);
            --danger-color: #ff6b6b;
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-main);
            background: var(--bg-gradient);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden; /* Prevent scroll on canvas */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Canvas Background */
        #visualizer-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* Main Glass Container */
        .container {
            position: relative;
            z-index: 10;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2.5rem;
            width: 90%;
            max-width: 650px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            animation: slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        header h1 {
            font-weight: 200;
            letter-spacing: 3px;
            font-size: 2rem;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 0.5rem;
        }

        header p {
            color: var(--text-muted);
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }

        /* Frequency Grid */
        .frequency-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .freq-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.25rem 0.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            outline: none;
        }

        .freq-btn:hover, .freq-btn:focus-visible {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .freq-btn.active {
            background: rgba(79, 172, 254, 0.15);
            border-color: var(--accent-color);
            box-shadow: var(--accent-glow);
            transform: scale(1.02);
        }

        /* Equalizer Bars Animation for Active Button */
        .playing-indicator {
            position: absolute;
            bottom: 6px;
            display: flex;
            gap: 2px;
            height: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .freq-btn.active .playing-indicator {
            opacity: 1;
        }

        .bar {
            width: 3px;
            background: var(--accent-color);
            animation: equalize 1s infinite alternate;
        }
        .bar:nth-child(2) { animation-delay: 0.2s; }
        .bar:nth-child(3) { animation-delay: 0.4s; }

        @keyframes equalize {
            0% { height: 2px; }
            100% { height: 10px; }
        }

        .hz {
            font-size: 1.4rem;
            font-weight: 600;
            display: block;
            margin-bottom: 0.25rem;
        }

        .label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.2px;
            font-weight: 500;
        }

        /* Controls Section */
        .controls-wrapper {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .description-area {
            min-height: 1.5rem;
            font-size: 0.95rem;
            color: var(--text-color);
            font-style: italic;
        }

        /* Volume Slider */
        .volume-control {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--text-muted);
            font-size: 0.8rem;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]:focus { outline: none; }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: var(--text-color);
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        /* Stop Button */
        .stop-btn {
            background: transparent;
            border: 1px solid rgba(255, 107, 107, 0.5);
            color: var(--danger-color);
            padding: 0.75rem 2rem;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            transition: all 0.3s;
            opacity: 0.5;
            pointer-events: none;
            align-self: center;
        }

        .stop-btn.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .stop-btn:hover {
            background: rgba(255, 107, 107, 0.1);
            border-color: var(--danger-color);
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.2);
        }

        @media (max-width: 600px) {
            .container { padding: 1.5rem; width: 95%; }
            .frequency-grid { grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
            h1 { font-size: 1.5rem; }
            .hz { font-size: 1.2rem; }
        }
    </style>
</head>

<body>

    <canvas id="visualizer-canvas"></canvas>

    <div class="container" role="main">
        <header>
            <h1>Solfeggio Healer</h1>
            <p>Pure Tone Frequencies for Healing & Meditation</p>
        </header>

        <div class="frequency-grid" role="group" aria-label="Frequency Selection">
            <button class="freq-btn" data-freq="174" data-desc="Pain relief, stress reduction, and foundation." aria-pressed="false">
                <span class="hz">174 Hz</span>
                <span class="label">Relief</span>
                <div class="playing-indicator"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </button>
            <button class="freq-btn" data-freq="285" data-desc="Healing tissues and organs, restoration." aria-pressed="false">
                <span class="hz">285 Hz</span>
                <span class="label">Heal</span>
                <div class="playing-indicator"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </button>
            <button class="freq-btn" data-freq="396" data-desc="Liberating guilt and fear, turning grief into joy." aria-pressed="false">
                <span class="hz">396 Hz</span>
                <span class="label">Liberate</span>
                <div class="playing-indicator"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </button>
            <button class="freq-btn" data-freq="417" data-desc="Undoing situations and facilitating change." aria-pressed="false">
                <span class="hz">417 Hz</span>
                <span class="label">Change</span>
                <div class="playing-indicator"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </button>
            <button class="freq-btn" data-freq="528" data-desc="Transformation and miracles (DNA Repair)." aria-pressed="false">
                <span class="hz">528 Hz</span>
                <span class="label">Miracle</span>
                <div class="playing-indicator"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </button>
            <button class="freq-btn" data-freq="639" data-desc="Connecting, relationships, and harmonizing." aria-pressed="false">
                <span class="hz">639 Hz</span>
                <span class="label">Connect</span>
                <div class="playing-indicator"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </button>
            <button class="freq-btn" data-freq="741" data-desc="Expression, solutions, and cleaning." aria-pressed="false">
                <span class="hz">741 Hz</span>
                <span class="label">Solve</span>
                <div class="playing-indicator"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </button>
            <button class="freq-btn" data-freq="852" data-desc="Returning to spiritual order, awakening intuition." aria-pressed="false">
                <span class="hz">852 Hz</span>
                <span class="label">Awaken</span>
                <div class="playing-indicator"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </button>
            <button class="freq-btn" data-freq="963" data-desc="Connection to the cosmos, awakening perfect state." aria-pressed="false">
                <span class="hz">963 Hz</span>
                <span class="label">Divine</span>
                <div class="playing-indicator"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </button>
        </div>

        <div class="controls-wrapper">
            <div class="description-area" id="desc-display" aria-live="polite">Select a frequency to begin.</div>
            
            <div class="volume-control">
                <span>Vol</span>
                <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5" aria-label="Volume">
            </div>

            <button class="stop-btn" id="stop-btn" aria-label="Stop Audio">Stop Audio</button>
        </div>
    </div>

    <script>
        /**
         * Solfeggio Healer - Audio & Visual Engine
         * Optimized for modern browsers with Web Audio API
         */

        // --- Audio Manager ---
        const AudioEngine = {
            ctx: null,
            masterGain: null,
            analyser: null, // Exposed for visualizer
            activeOscillator: null,
            activeGain: null,
            volume: 0.5,

            init() {
                if (!this.ctx) {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    this.ctx = new AudioContext();
                    
                    // Master volume control
                    this.masterGain = this.ctx.createGain();
                    this.masterGain.gain.value = this.volume;
                    
                    // Analyser for visuals
                    this.analyser = this.ctx.createAnalyser();
                    this.analyser.fftSize = 256;
                    this.analyser.smoothingTimeConstant = 0.8;

                    // Graph: Master -> Analyser -> Speaker
                    this.masterGain.connect(this.analyser);
                    this.analyser.connect(this.ctx.destination);
                }
                
                if (this.ctx.state === 'suspended') {
                    this.ctx.resume();
                }
            },

            play(frequency) {
                this.init();
                const fadeTime = 0.3; // Seconds for crossfade
                const now = this.ctx.currentTime;

                // 1. Stop existing sound (crossfade out)
                if (this.activeOscillator) {
                    this.stopCurrent(fadeTime);
                }

                // 2. Create new source
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();

                osc.type = 'sine';
                osc.frequency.setValueAtTime(frequency, now);

                // 3. Connect: Osc -> Gain -> Master
                osc.connect(gain);
                gain.connect(this.masterGain);

                // 4. Envelope (Attack)
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(1, now + fadeTime);

                osc.start(now);

                // 5. Track state
                this.activeOscillator = osc;
                this.activeGain = gain;
            },

            stopCurrent(fadeTime = 0.5) {
                if (!this.activeOscillator || !this.activeGain) return;

                const now = this.ctx.currentTime;
                const osc = this.activeOscillator;
                const gain = this.activeGain;

                // Release envelope
                gain.gain.cancelScheduledValues(now);
                gain.gain.setValueAtTime(gain.gain.value, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + fadeTime);

                osc.stop(now + fadeTime + 0.1);
                
                // Disconnect after stop to free memory
                setTimeout(() => {
                    osc.disconnect();
                    gain.disconnect();
                }, (fadeTime + 0.2) * 1000);

                // Clear current tracking immediately so new notes can take over
                this.activeOscillator = null;
                this.activeGain = null;
            },

            setVolume(val) {
                this.volume = val;
                if (this.masterGain) {
                    // Smooth transition for volume change
                    this.masterGain.gain.setTargetAtTime(val, this.ctx.currentTime, 0.1);
                }
            },

            isPlaying() {
                return !!this.activeOscillator;
            }
        };

        // --- Visualizer Engine ---
        const Visualizer = {
            canvas: document.getElementById('visualizer-canvas'),
            ctx: document.getElementById('visualizer-canvas').getContext('2d'),
            particles: [],
            width: 0,
            height: 0,
            baseRadius: 0,

            init() {
                this.resize();
                window.addEventListener('resize', () => this.resize());
                
                // Initialize random particles
                for(let i = 0; i < 50; i++) {
                    this.particles.push(new Particle(this.width, this.height));
                }
                
                this.animate();
            },

            resize() {
                // High DPI scaling
                const dpr = window.devicePixelRatio || 1;
                this.width = window.innerWidth;
                this.height = window.innerHeight;
                
                this.canvas.width = this.width * dpr;
                this.canvas.height = this.height * dpr;
                
                this.ctx.scale(dpr, dpr);
                this.baseRadius = Math.min(this.width, this.height) / 4;
            },

            animate() {
                this.ctx.clearRect(0, 0, this.width, this.height);

                let audioData = 0;
                
                // Get audio data if playing
                if (AudioEngine.analyser && AudioEngine.isPlaying()) {
                    const bufferLength = AudioEngine.analyser.frequencyBinCount;
                    const dataArray = new Uint8Array(bufferLength);
                    AudioEngine.analyser.getByteFrequencyData(dataArray);
                    
                    // Calculate average amplitude
                    let sum = 0;
                    for (let i = 0; i < bufferLength; i++) {
                        sum += dataArray[i];
                    }
                    audioData = sum / bufferLength; // 0 to 255
                }

                // Update and draw particles based on audio energy
                const energy = audioData / 255; // Normalized 0-1
                
                this.particles.forEach(p => {
                    p.update(energy, this.width, this.height);
                    p.draw(this.ctx);
                });

                // Draw central glow
                if (energy > 0.01) {
                    const glowRadius = this.baseRadius + (energy * 100);
                    const grad = this.ctx.createRadialGradient(
                        this.width/2, this.height/2, this.baseRadius * 0.5,
                        this.width/2, this.height/2, glowRadius
                    );
                    grad.addColorStop(0, `rgba(79, 172, 254, ${0.2 * energy})`);
                    grad.addColorStop(1, 'rgba(0,0,0,0)');
                    
                    this.ctx.fillStyle = grad;
                    this.ctx.beginPath();
                    this.ctx.arc(this.width/2, this.height/2, glowRadius, 0, Math.PI * 2);
                    this.ctx.fill();
                }

                requestAnimationFrame(() => this.animate());
            }
        };

        class Particle {
            constructor(w, h) {
                this.init(w, h);
            }

            init(w, h) {
                this.x = Math.random() * w;
                this.y = Math.random() * h;
                this.size = Math.random() * 2 + 1;
                this.speedX = (Math.random() - 0.5) * 0.5;
                this.speedY = (Math.random() - 0.5) * 0.5;
                this.opacity = Math.random() * 0.5 + 0.1;
            }

            update(energy, w, h) {
                // Speed increases with music energy
                const speedMult = 1 + (energy * 5);
                
                this.x += this.speedX * speedMult;
                this.y += this.speedY * speedMult;

                // Wrap around screen
                if (this.x < 0) this.x = w;
                if (this.x > w) this.x = 0;
                if (this.y < 0) this.y = h;
                if (this.y > h) this.y = 0;
                
                // Pulse size with energy
                this.currentSize = this.size + (energy * 3);
            }

            draw(ctx) {
                ctx.fillStyle = `rgba(180, 220, 255, ${this.opacity})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.currentSize, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // --- Interaction Logic ---
        const buttons = document.querySelectorAll('.freq-btn');
        const descDisplay = document.getElementById('desc-display');
        const stopBtn = document.getElementById('stop-btn');
        const volumeSlider = document.getElementById('volume-slider');

        function updateUI(activeBtn = null) {
            buttons.forEach(btn => {
                const isActive = btn === activeBtn;
                btn.classList.toggle('active', isActive);
                btn.setAttribute('aria-pressed', isActive);
            });

            if (activeBtn) {
                stopBtn.classList.add('visible');
                descDisplay.textContent = activeBtn.dataset.desc;
                descDisplay.style.opacity = '1';
            } else {
                stopBtn.classList.remove('visible');
                descDisplay.textContent = "Audio paused.";
                descDisplay.style.opacity = '0.7';
            }
        }

        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                const freq = parseFloat(btn.dataset.freq);
                
                // If clicking the already active button, do nothing (or could toggle off)
                if (btn.classList.contains('active')) return;

                updateUI(btn);
                AudioEngine.play(freq);
            });
        });

        stopBtn.addEventListener('click', () => {
            AudioEngine.stopCurrent();
            updateUI(null);
        });

        volumeSlider.addEventListener('input', (e) => {
            AudioEngine.setVolume(parseFloat(e.target.value));
        });

        // Initialize Visuals immediately
        Visualizer.init();

    </script>
</body>
</html>